<form method="post" action="{{ request.path }}">
  {% csrf_token %}

  <table class="table table-sm table-bordered">
    <thead>
      <tr>
        <th class="text-center">
          <input type="checkbox" id="check-all">
        </th>
        <th>Tanggal SP2D</th>
        <th>Nomor SP2D</th>
        <th class="text-end">Nilai</th>
      </tr>
    </thead>

    <tbody>
      {% for row in data %}
      <tr>
        <td class="text-center">
          <input type="checkbox"
                class="check-item"
                name="sp2d"
                value="{{ row.nomor_sp2d }}">
        </td>
        <td>{{ row.tanggal_sp2d }}</td>
        <td>{{ row.nomor_sp2d }}</td>
        <td class="text-end">
          {{ row.nilai_realisasi|floatformat:2 }}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center text-muted">
          Data SIPD tidak ditemukan
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button type="submit" class="btn btn-success"
          onclick="return document.querySelectorAll('.check-item:checked').length > 0;">
    Simpan ke Realisasi
  </button>
</form>

<script>
document.body.addEventListener('htmx:afterSwap', function (evt) {
  // pastikan yang di-swap adalah modal
  if (!evt.target.closest('#verifikasiModal')) return;

  const checkAll = document.getElementById('check-all');
  const items = document.querySelectorAll('.check-item');

  if (!checkAll || items.length === 0) return;

  checkAll.addEventListener('change', function () {
    items.forEach(cb => cb.checked = checkAll.checked);
  });

  items.forEach(cb => {
    cb.addEventListener('change', function () {
      checkAll.checked = [...items].every(i => i.checked);
    });
  });
});
</script>